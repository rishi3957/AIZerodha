
function addElement(){
var actionSpan=document.createElement('span');
actionSpan.setAttribute('class','actions');
actionSpan.innerHTML=`<span data-balloon="Buy (B)" data-balloon-pos="up"><button type="button" class="button-blue buy">B <!----></button></span> <span data-balloon="Sell (S)" data-balloon-pos="up"><button type="button" class="button-orange sell">S <!----></button></span> <span data-balloon="Market Depth (D)" data-balloon-pos="up"><button type="button" class="button-outline"><span class="icon icon-align-center"></span> <!----></button></span> <span data-balloon="Chart (C)" data-balloon-pos="up"><button type="button" class="button-outline"><span class="icon icon-trending-up"></span> <!----></button></span> <span data-balloon="Delete (del)" data-balloon-pos="up"><button type="button" class="button-outline"><span class="icon icon-trash"></span> <!----></button></span> <div id="context-menu-1231" class="context-menu"><div class="context-menu-button-wrap"><button type="button" class="context-menu-button button-outline" data-balloon="More" data-balloon-pos="up"><span class="icon icon-ellipsis"></span> <!----></button></div> <!----></div>`

// actionSpan.setAttribute('class','vddl-draggable instrument up index3');
// actionSpan.innerHTML=`<div><div class="info price-change-type-close-all"><div class="symbol-wrapper"><div class="symbol"><span class="nice-name">TCS</span> <!----></div> <!----></div> <div class="price-wrapper"><div class="price-change"><div class="dim"><span class="price-absolute">
//                                 17.10
//                             </span> <span class="price-percentage">
//                                 0.45<span class="text-xxsmall">%</span></span></div></div> <div class="price"><span class="change-indicator icon icon-chevron-up"></span> <!----> <!----> <span class="last-price">
//                             3843.30
//                         </span></div></div></div> <span class="actions"><span data-balloon="Buy (B)" data-balloon-pos="up"><button type="button" class="button-blue buy">B <!----></button></span> <span data-balloon="Sell (S)" data-balloon-pos="up"><button type="button" class="button-orange sell">S <!----></button></span> <span data-balloon="Market Depth (D)" data-balloon-pos="up"><button type="button" class="button-outline"><span class="icon icon-align-center"></span> <!----></button></span> <span data-balloon="Chart (C)" data-balloon-pos="up"><button type="button" class="button-outline"><span class="icon icon-trending-up"></span> <!----></button></span> <span data-balloon="Delete (del)" data-balloon-pos="up"><button type="button" class="button-outline"><span class="icon icon-trash"></span> <!----></button></span> <div id="context-menu-125" class="context-menu"><div class="context-menu-button-wrap"><button type="button" class="context-menu-button button-outline" data-balloon="More" data-balloon-pos="up"><span class="icon icon-ellipsis"></span> <!----></button></div> <!----></div></span> <!----> <!----></div>`

document.querySelector("#app > div.container.wrapper > div.container-left > div > div.instruments > div > div.vddl-draggable.instrument.index3").childNodes[0].replaceChild(
actionSpan,document.querySelector("#app > div.container.wrapper > div.container-left > div > div.instruments > div > div.vddl-draggable.instrument.index3").childNodes[0].childNodes[2]
)
}

function buy(stock){
    form=document.createElement('form')
    form.setAttribute('class','order-window layer-2 place buy variety-regular');
    form.setAttribute('style',"top: auto; bottom: 0px;");
    form.innerHTML=`<div class="drag-handle"></div> <header><div class="row instrument-row"><div class="eight columns instrument"><span class="tradingsymbol"><span class="name">${stock.shareName.toUpperCase()}</span></span> <!----></div> <div class="four columns text-right toolbar"><div class="wrap-right"><div class="nudge"><!----> <!----></div> <div class="tx-toggle"><div class="su-switch-group"><!----> <input id="switch-134" type="checkbox" stateon="SELL" stateoff="BUY" label="" class="su-switch" value="BUY"> <label for="switch-134" class="su-switch-control"></label> <!----></div></div></div></div></div> <div class="exchange-selector"><div class="su-radio-group"><div class="exchange su-radio-wrap"><input id="radio-136" type="radio" name="exchange" label="BSE &amp;nbsp;<span class='last-price'>₹3,838.65</span>" class="su-radio" value="BSE"> <label for="radio-136" class="su-radio-label">BSE &nbsp;<span class="last-price">₹3,838.65</span></label></div><div class="exchange su-radio-wrap checked"><input id="radio-137" type="radio" checked name="exchange" label="NSE &amp;nbsp;<span class='last-price'>₹3,839.95</span>" class="su-radio" value="NSE"> <label for="radio-137" class="su-radio-label">NSE &nbsp;<span class="last-price">₹3,839.95</span></label></div></div></div></header> <section class="wrap"><!----> <div class="content"><div class="variety"><div class="su-radio-group"><span class="pos-relative"><div class="su-radio-wrap type quick" data-balloon="Quick order" data-balloon-pos="up"><input id="radio-139" type="radio" name="variety" title="Quick order" label="Quick" class="su-radio" value="quick"> <label for="radio-139" class="su-radio-label">Quick</label></div></span><span class="pos-relative"><div class="su-radio-wrap checked type regular" data-balloon="Regular order" data-balloon-pos="up"><input id="radio-140" type="radio" checked name="variety" title="Regular order" label="Regular" class="su-radio" value="regular"> <label for="radio-140" class="su-radio-label">Regular</label></div></span><span class="pos-relative"><div class="su-radio-wrap type co" data-balloon="Cover order" data-balloon-pos="up"><input id="radio-141" type="radio" name="variety" title="Cover order" label="Cover" class="su-radio" value="co"> <label for="radio-141" class="su-radio-label">Cover</label></div></span><span class="pos-relative"><div class="su-radio-wrap type amo" data-balloon="After Market Order (for the next day)" data-balloon-pos="up"><input id="radio-142" type="radio" name="variety" title="After Market Order (for the next day)" label="AMO" class="su-radio" value="amo"> <label for="radio-142" class="su-radio-label">AMO</label></div></span><span class="pos-relative"><div class="su-radio-wrap type iceberg" data-balloon="Split an order into smaller orders" data-balloon-pos="up"><input id="radio-143" type="radio" name="variety" title="Split an order into smaller orders" label="Iceberg" class="su-radio" value="iceberg"> <label for="radio-143" class="su-radio-label">Iceberg</label></div></span></div> <div class="tags-menu"><a href=""><span class="icon icon-tag"></span>Tags <!----></a></div></div> <div class="body"><div class="product row"><div class="su-radio-group"><div class="type four columns su-radio-wrap" data-balloon="Intraday (MIS) orders will be exited before the market closes." data-balloon-pos="up" data-balloon-length="large"><input id="radio-145" ${stock.transactionType=="intraday"?'checked':''} type="radio" name="product" title="Intraday (MIS) orders will be exited before the market closes." label="Intraday <span>MIS</span>" class="su-radio" value="MIS"> <label for="radio-145" class="su-radio-label">Intraday <span>MIS</span></label></div><div class="type four columns su-radio-wrap" data-balloon="CashNCarry: Longterm investment. Requires full upfront margin." data-balloon-pos="up" data-balloon-length="large"><input id="radio-146" ${stock.transactionType=="intraday"?'':'checked'} type="radio" name="product" title="CashNCarry: Longterm investment. Requires full upfront margin." label="Longterm <span>CNC</span>" class="su-radio" value="CNC"> <label for="radio-146" class="su-radio-label">Longterm <span>CNC</span></label></div></div> <div class="more-options"><a href="#" class="text-xsmall more-options"><span data-balloon="Show advanced options" data-balloon-pos="up">Advanced <span class="icon icon-chevron-down"></span></span></a></div></div> <div class="first-fields"><div class="row row-1"><div class="four columns quantity"><div class="no su-input-group su-static-label su-has-button"><input type="number" value=${stock.qty} placeholder="" autocorrect="off" min="1" max="50000000" step="1" autofocus="autofocus" nativeerror="true" staticlabel="true" animate="true" label="Qty." rules="[object Object],[object Object],[object Object]" dynamicwidthsize="8" button="[object Object]" id="erc6w1zerzt"> <button disabled="disabled" type="button" tabindex="-1" data-balloon="Switch quantity / lots / amount" data-balloon-pos="up"><span class="icon icon-layers"></span> <!----></button> <label class="su-input-label su-visible" for="erc6w1zerzt">Qty.</label> <!----> <!----> <!----> <!----></div> <!----> <!----></div> <div class="four columns price"><div class="no su-input-group su-static-label"><input type="number" value=${parseFloat(stock.price)} placeholder="" autocorrect="off" min="0.05" step="0.05" nativeerror="true" staticlabel="true" animate="true" label="Price" rules="[object Object]" dynamicwidthsize="8" id="qicq9br9bi"> <!----> <label class="su-input-label su-visible" for="qicq9br9bi">Price</label> <!----> <!----> <!----> <!----></div></div> <div class="four columns trigger"><div class="no su-input-group su-static-label disabled"><input type="number" placeholder="" autocorrect="off" min="0" step="0.05" disabled="disabled" nativeerror="true" staticlabel="true" animate="true" label="Trigger price" rules="[object Object],[object Object]" dynamicwidthsize="8" id="jtwx0oc8ss"> <!----> <label class="su-input-label" for="jtwx0oc8ss">Trigger price</label> <!----> <!----> <!----> <!----></div></div></div> <div class="row row-2"><div class="four columns quantity-helpers"><!----> <div><span class="x-small text-light"><!----> <!----></span> &nbsp; </div></div> <div class="four columns price"><div class="su-radio-group order-type"><div class="su-radio-wrap" tooltip-pos="down" data-balloon="Buy at market price" data-balloon-pos="down"><input id="radio-152" type="radio" ${stock.orderType=="market"?'checked':''} name="orderType" title="Buy at market price" label="Market" class="su-radio" value="MARKET"> <label for="radio-152" class="su-radio-label">Market</label></div> <div class="su-radio-wrap" tooltip-pos="down" data-balloon="Buy at a preferred price" data-balloon-pos="down"><input id="radio-153" type="radio" ${stock.orderType=="limit"?'checked':''} name="orderType" title="Buy at a preferred price" label="Limit" class="su-radio" value="LIMIT"> <label for="radio-153" class="su-radio-label">Limit</label></div></div></div> <div class="four columns trigger"><div class="su-radio-group text-right order-type"><div class="su-radio-wrap" tooltip-pos="down" data-balloon="Buy at a preferred price with a stoploss" data-balloon-pos="down"><input id="radio-155" type="radio" name="orderType" title="Buy at a preferred price with a stoploss" label="SL" class="su-radio" value="SL"> <label for="radio-155" class="su-radio-label">SL</label></div> <div class="su-radio-wrap" tooltip-pos="down" data-balloon="Buy at market price with stoploss" data-balloon-pos="down"><input id="radio-156" type="radio" name="orderType" title="Buy at market price with stoploss" label="SL-M" class="su-radio" value="SL-M"> <label for="radio-156" class="su-radio-label">SL-M</label></div></div></div></div> <!----></div> <!----> <!----></div> <!----> <footer class="footer row"><div class="seven columns"><div class="row margins"><div class="block"><label>Margin</label> <span class="value"><a target="_blank" href="https://support.zerodha.com/category/trading-and-markets/kite-web-and-mobile/articles/margins-on-kite-order-window" data-balloon="Margin calculation explained" data-balloon-pos="up"> ₹767.86 </a></span></div> <div class="block charges"><label>Charges</label> <span class="value"><a href="#" data-balloon="View charges &amp; taxes" data-balloon-pos="up"> ₹1.51 </a> <!----></span> <a href="#" class="refresh-margins" data-balloon="Refresh" data-balloon-pos="up"><span class="reload-margin icon icon-reload"></span></a></div></div></div> <div class="five columns text-right actions"><button type="submit" class="submit"><span>Buy</span> <!----></button> <button type="button" class="button-outline button-transparent cancel">Cancel <!----></button></div></footer></div></section> <!----> <!----> <!----> <!---->`

    document.querySelector("#app").replaceChild(form,document.querySelector("#app").childNodes[4])

    form.querySelector("section > div > footer > div.five.columns.text-right.actions > button.button-outline.button-transparent.cancel").onclick=function(){
        document.querySelector("#app > form").replaceWith(document.createComment('<!---->'))
    }
}
function sell(stock){
  form=document.createElement('form')
  form.setAttribute('class','order-window layer-2 place sell variety-regular');
  form.setAttribute('style',"top: auto; bottom: 0px;");
  form.innerHTML=`<div class="drag-handle"></div> <header><div class="row instrument-row"><div class="eight columns instrument"><span class="tradingsymbol"><span class="name">${stock.shareName.toUpperCase()}</span></span> <!----></div> <div class="four columns text-right toolbar"><div class="wrap-right"><div class="nudge"><!----> <!----></div> <div class="tx-toggle"><div class="su-switch-group"><!----> <input id="switch-163" type="checkbox" checked stateon="SELL" stateoff="BUY" label="" class="su-switch" value="SELL"> <label for="switch-163" class="su-switch-control"></label> <!----></div></div></div></div></div> <div class="exchange-selector"><div class="su-radio-group"><div class="exchange su-radio-wrap"><input id="radio-165" type="radio" name="exchange" label="BSE &amp;nbsp;<span class='last-price'>₹3,859.90</span>" class="su-radio" value="BSE"> <label for="radio-165" class="su-radio-label">BSE &nbsp;<span class="last-price">₹3,859.90</span></label></div><div class="exchange su-radio-wrap checked"><input id="radio-166" type="radio" checked name="exchange" label="NSE &amp;nbsp;<span class='last-price'>₹3,859.65</span>" class="su-radio" value="NSE"> <label for="radio-166" class="su-radio-label">NSE &nbsp;<span class="last-price">₹3,859.65</span></label></div></div></div></header> <section class="wrap"><!----> <div class="content"><div class="variety"><div class="su-radio-group"><span class="pos-relative"><div class="su-radio-wrap type quick" data-balloon="Quick order" data-balloon-pos="up"><input id="radio-168" type="radio" name="variety" title="Quick order" label="Quick" class="su-radio" value="quick"> <label for="radio-168" class="su-radio-label">Quick</label></div></span><span class="pos-relative"><div class="su-radio-wrap checked type regular" data-balloon="Regular order" data-balloon-pos="up"><input id="radio-169" type="radio" checked name="variety" title="Regular order" label="Regular" class="su-radio" value="regular"> <label for="radio-169" class="su-radio-label">Regular</label></div></span><span class="pos-relative"><div class="su-radio-wrap type co" data-balloon="Cover order" data-balloon-pos="up"><input id="radio-170" type="radio" name="variety" title="Cover order" label="Cover" class="su-radio" value="co"> <label for="radio-170" class="su-radio-label">Cover</label></div></span><span class="pos-relative"><div class="su-radio-wrap type amo" data-balloon="After Market Order (for the next day)" data-balloon-pos="up"><input id="radio-171" type="radio" name="variety" title="After Market Order (for the next day)" label="AMO" class="su-radio" value="amo"> <label for="radio-171" class="su-radio-label">AMO</label></div></span><span class="pos-relative"><div class="su-radio-wrap type iceberg" data-balloon="Split an order into smaller orders" data-balloon-pos="up"><input id="radio-172" type="radio" name="variety" title="Split an order into smaller orders" label="Iceberg" class="su-radio" value="iceberg"> <label for="radio-172" class="su-radio-label">Iceberg</label></div></span></div> <div class="tags-menu"><a href=""><span class="icon icon-tag"></span>Tags <!----></a></div></div> <div class="body"><div class="product row"><div class="su-radio-group"><div class="type four columns su-radio-wrap checked" data-balloon="Intraday (MIS) orders will be exited before the market closes." data-balloon-pos="up" data-balloon-length="large"><input id="radio-174" type="radio" ${stock.transactionType!="intraday"?'':'checked'} name="product" title="Intraday (MIS) orders will be exited before the market closes." label="Intraday <span>MIS</span>" class="su-radio" value="MIS"> <label for="radio-174" class="su-radio-label">Intraday <span>MIS</span></label></div><div class="type four columns su-radio-wrap" data-balloon="CashNCarry: Longterm investment. Requires full upfront margin." data-balloon-pos="up" data-balloon-length="large"><input id="radio-175" type="radio" ${stock.transactionType=="intraday"?'':'checked'} name="product" title="CashNCarry: Longterm investment. Requires full upfront margin." label="Longterm <span>CNC</span>" class="su-radio" value="CNC"> <label for="radio-175" class="su-radio-label">Longterm <span>CNC</span></label></div></div> <div class="more-options"><a href="#" class="text-xsmall more-options"><span data-balloon="Show advanced options" data-balloon-pos="up">Advanced <span class="icon icon-chevron-down"></span></span></a></div></div> <div class="first-fields"><div class="row row-1"><div class="four columns quantity"><div class="no su-input-group su-static-label su-has-button"><input type="number" placeholder="" value=${stock.qty} autocorrect="off" min="1" max="50000000" step="1" autofocus="autofocus" nativeerror="true" staticlabel="true" animate="true" label="Qty." rules="[object Object],[object Object],[object Object]" dynamicwidthsize="8" button="[object Object]" id="jkahqip95dn"> <button disabled="disabled" type="button" tabindex="-1" data-balloon="Switch quantity / lots / amount" data-balloon-pos="up"><span class="icon icon-layers"></span> <!----></button> <label class="su-input-label su-visible" for="jkahqip95dn">Qty.</label> <!----> <!----> <!----> <!----></div> <!----> <!----></div> <div class="four columns price"><div class="no su-input-group su-static-label"><input type="number" placeholder="" value=${parseFloat(stock.price)} autocorrect="off" min="0.05" step="0.05" nativeerror="true" staticlabel="true" animate="true" label="Price" rules="[object Object]" dynamicwidthsize="8" id="ezs1vm0ygxi"> <!----> <label class="su-input-label su-visible" for="ezs1vm0ygxi">Price</label> <!----> <!----> <!----> <!----></div></div> <div class="four columns trigger"><div class="no su-input-group su-static-label disabled"><input type="number" placeholder="" autocorrect="off" min="0" step="0.05" disabled="disabled" nativeerror="true" staticlabel="true" animate="true" label="Trigger price" rules="[object Object],[object Object]" dynamicwidthsize="8" id="00qinib02zlb"> <!----> <label class="su-input-label" for="00qinib02zlb">Trigger price</label> <!----> <!----> <!----> <!----></div></div></div> <div class="row row-2"><div class="four columns quantity-helpers"><!----> <div><span class="x-small text-light"><!----> <!----></span> &nbsp; </div></div> <div class="four columns price"><div class="su-radio-group order-type"><div class="su-radio-wrap" tooltip-pos="down" data-balloon="Sell at market price" data-balloon-pos="down"><input id="radio-181" type="radio" ${stock.orderType=="limit"?'':'checked'} name="orderType" title="Sell at market price" label="Market" class="su-radio" value="MARKET"> <label for="radio-181" class="su-radio-label">Market</label></div> <div class="su-radio-wrap checked" tooltip-pos="down" data-balloon="Sell at a preferred price" data-balloon-pos="down"><input id="radio-182" type="radio" ${stock.orderType!="limit"?'':'checked'} name="orderType" title="Sell at a preferred price" label="Limit" class="su-radio" value="LIMIT"> <label for="radio-182" class="su-radio-label">Limit</label></div></div></div> <div class="four columns trigger"><div class="su-radio-group text-right order-type"><div class="su-radio-wrap" tooltip-pos="down" data-balloon="Sell at a preferred price with a stoploss" data-balloon-pos="down"><input id="radio-184" type="radio" name="orderType" title="Sell at a preferred price with a stoploss" label="SL" class="su-radio" value="SL"> <label for="radio-184" class="su-radio-label">SL</label></div> <div class="su-radio-wrap" tooltip-pos="down" data-balloon="Sell at market price with stoploss" data-balloon-pos="down"><input id="radio-185" type="radio" name="orderType" title="Sell at market price with stoploss" label="SL-M" class="su-radio" value="SL-M"> <label for="radio-185" class="su-radio-label">SL-M</label></div></div></div></div> <!----></div> <!----> <!----></div> <!----> <footer class="footer row"><div class="seven columns"><div class="row margins"><div class="block"><label>Margin</label> <span class="value"><a target="_blank" href="https://support.zerodha.com/category/trading-and-markets/kite-web-and-mobile/articles/margins-on-kite-order-window" data-balloon="Margin calculation explained" data-balloon-pos="up"> ₹772.17 </a></span></div> <div class="block charges"><label>Charges</label> <span class="value"><a href="#" data-balloon="View charges &amp; taxes" data-balloon-pos="up"> ₹2.49 </a> <!----></span> <a href="#" class="refresh-margins" data-balloon="Refresh" data-balloon-pos="up"><span class="reload-margin icon icon-reload"></span></a></div></div></div> <div class="five columns text-right actions"><button type="submit" class="submit"><span>Sell</span> <!----></button> <button type="button" class="button-outline button-transparent cancel">Cancel <!----></button></div></footer></div></section> <!----> <!----> <!----> <!---->`

  document.querySelector("#app").replaceChild(form,document.querySelector("#app").childNodes[4])

  form.querySelector("section > div > footer > div.five.columns.text-right.actions > button.button-outline.button-transparent.cancel").onclick=function(){
      document.querySelector("#app > form").replaceWith(document.createComment('<!---->'))
  }
}


chrome.runtime.onMessage.addListener(function(message, sender, sendResponse) {
    console.log("Executing script in content script");
   

    if (message.action.actionType==='buy') {
      buy(message.action);
    }
    else if (message.action.actionType==='sell') sell(message.action)
    else  document.querySelector("#app > div.header > div > div.header-right > div.app-nav > a:nth-child("+message.action+")").click();


    if (message.action === "triggerHover") {
        //   const divToHover = document.querySelector("#app > div.container.wrapper > div.container-left > div > div.instruments > div > div.vddl-draggable.instrument.up.index3");
        //   const mouseOverEvent = new MouseEvent('mouseover', {
        //     bubbles: true,
        //     cancelable: true,
        //     view: window
        //   });
        //   divToHover.dispatchEvent(mouseOverEvent);
        addElement()
        }
  });
